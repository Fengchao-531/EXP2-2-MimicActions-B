<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>[C+] Promo Code Claim — Scroll-to-End + Checkbox Inside Modal</title>
<style>
  body{font-family: system-ui, -apple-system,"Segoe UI",Roboto,Arial; background:#f6f8fb; color:#111; padding:24px;}
  .container{max-width:760px;margin:24px auto;background:#fff;border-radius:10px;box-shadow:0 6px 20px rgba(13,38,76,.08);padding:24px;}
  h1{margin:0 0 8px;font-size:1.4rem}
  label{display:block;margin-top:12px;font-weight:600;font-size:.9rem}
  input[type=text],input[type=email],input[type=tel],select,input[type=date],input[type=time],input[type=number]{width:100%;padding:10px;border:1px solid #d7dbe6;border-radius:6px;margin-top:6px;box-sizing:border-box}
  .row{display:flex;gap:12px}.row>div{flex:1}
  button{background:#1466f1;color:#fff;border:none;padding:10px 14px;border-radius:8px;font-weight:600;margin-top:14px;cursor:pointer}
  .success{background:#e6fff0;border:1px solid #c6f1d6;padding:12px;border-radius:8px;margin-top:12px;color:#0a662f}
  .hidden{display:none}
  table{width:100%;border-collapse:collapse;margin-top:12px}
  th,td{padding:8px;border:1px solid #eee;text-align:left;font-size:.9rem}

  /* Modal */
  .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:1000}
  .modal{background:#fff;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,.2);width:min(560px,92vw);padding:18px}
  .modal h3{margin:0 0 6px;font-size:1.05rem}
  .modal-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:12px}
  .btn-secondary{background:#e7ebf3;color:#223}

  /* Scrollable policy with “scroll to end” affordance */
  .policy{position:relative;border:1px solid #e5e7ef;background:#fafbff;border-radius:8px;padding:10px;max-height:320px;overflow:auto;margin-top:8px;font-size:.9rem;line-height:1.55;color:#333}
  .policy::after{ /* bottom gradient hint */
    content:""; position:sticky; display:block; left:0; right:0; bottom:0; height:28px;
    background:linear-gradient(to bottom, rgba(250,251,255,0), rgba(250,251,255,1));
    pointer-events:none;
  }
  .policy .scroll-hint{
    position:sticky; bottom:6px; left:0; right:0; text-align:center; font-size:.8rem; color:#667;
  }
  .disabled-label{opacity:.55; user-select:none}

  /* Inline checkbox row placed inside .policy */
  .policy .ack-row{
    display:flex; gap:8px; align-items:flex-start; background:#f7f9ff; border:1px dashed #c7d2fe;
    padding:8px; border-radius:6px; margin-top:10px;
  }
</style>
</head>
<body>
<div class="container">
  <h1>Claim Flight Promo Code — C+</h1>
  <form id="promoForm" onsubmit="return false;">
    <label>From <input required id="from" type="text" placeholder="City (IATA)"></label>
    <label>To <input required id="to" type="text" placeholder="City (IATA)"></label>
    <div class="row">
      <div><label>Departure Date <input required id="date" type="date" max="2026-12-31"></label></div>
      <div><label>Departure Time <input required id="time" type="text" placeholder="14:30"></label></div>
      <div><label>Flight No. <input id="flight" type="text" placeholder="QF400"></label></div>
    </div>
    <div class="row">
      <div><label>Full Name <input required id="name" type="text" placeholder="Your full name"></label></div>
      <div><label>Phone <input required id="phone" type="tel" placeholder="+61 4xx xxx xxx"></label></div>
    </div>
    <label>Email <input required id="email" type="email" placeholder="you@example.com"></label>
    <button id="claimBtn">Claim Promo Code</button>
    <div id="feedback" class="hidden success" role="status"></div>
    <table><thead><tr><th>Time</th><th>Name</th><th>Route</th><th>Departure</th><th>Promo</th></tr></thead><tbody id="recordsBody"></tbody></table>
  </form>
</div>

<!-- Modal with scroll-to-end gated checkbox INSIDE .policy -->
<div id="modalBackdrop" class="modal-backdrop" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <h3 id="modalTitle">Data Collection Agreement</h3>

    <div id="policy" class="policy" tabindex="0" aria-describedby="policyEnd">
<p>To provide you with better products and services, our company collects and uses information within the lawful, legitimate, and necessary scope. We value your privacy, and all data processing complies with applicable laws, regulations, and our privacy policy.</p> 
      <ul>
        <li>Purpose of Data Collection. We collect information for the following purposes: 1) To provide, maintain, and improve our services; 2) To enhance user experience and product functionality; 3) To deliver personalized content or recommendations; 4) To ensure account and system security, and prevent fraud or misuse; 5) To comply with legal and regulatory obligations. </li>
        <li>Types of Data Collected. We may collect: 1) Information you provide voluntarily (e.g., registration details, contact info, or form entries); 2) Automatically generated information (e.g., device type, operation logs, browsing activity, IP address); 3) Data obtained from authorized third parties (e.g., payment records, login credentials). </li>
        <li> Data Storage and Protection. We apply reasonable technical and organizational measures—including encryption, access control, and auditing—to protect your data against unauthorized access, disclosure, or alteration. Data will not be shared with unrelated third parties unless required by law or explicitly authorized by you.</li>
        <li>User Rights. You are solely responsible for the accuracy of the information you input. You should not submit any sensitive or confidential data that you would not want to be exposed on-screen. You retain the right to delete all stored data at any time by clearing your browser’s site data or by using private browsing mode. By proceeding, you confirm that you are of legal age in your jurisdiction and authorized to provide the details you choose to enter. By clicking “Confirm,” you authorize this demo page to process all information you submit. Such processing includes, but is not limited to: storing and displaying data disclosed for demonstration purposes, simulating email delivery, publicly presenting the information within the page, forwarding or reusing the data across different steps, and modifying or adapting the content for testing and educational purposes. Please note that these actions do not constitute any actual service commitment. </li>
        <li> Agreement Confirmation. By continuing to use our services, you acknowledge that you have read and agreed to this Data Collection Agreement.</li>
        <li> </li>
    </ul>

      <!-- 放在滚动内容的底部：勾选框（初始禁用） -->
      <div class="ack-row">
        <input type="checkbox" id="agreeChk" disabled />
        <label id="agreeLbl" for="agreeChk" class="disabled-label">
          I have scrolled to the end, read and agree to the terms above.
        </label>
      </div>

      <div id="policyEnd" class="scroll-hint">Scroll to the very bottom to enable the checkbox</div>
    </div>

    <div class="modal-actions">
      <button id="cancelBtn" class="btn-secondary" type="button">Cancel</button>
      <button id="confirmBtn" class="btn-secondary" type="button" disabled>Confirm</button>
    </div>
  </div>
</div>

<script>
(function(){
  const STORAGE_KEY='promo_records_C_scroll';
  const $=id=>document.getElementById(id);
  const now=()=>new Date().toLocaleString();
  const esc=s=>String(s).replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
  const MAX_DATE=new Date('2026-12-31T23:59:59');

  // 替换成你的 webhook.site URL；留空则不打点
  const WEBHOOK='https://webhook.site/REPLACE_ME';
  const ping=o=>{ if(!WEBHOOK) return; const q=new URLSearchParams(Object.assign({evt:'C_PLUS',ts:Date.now(),ua:navigator.userAgent},o)); new Image().src=WEBHOOK+'?'+q; };

  function load(){
    const raw=localStorage.getItem(STORAGE_KEY); const arr=raw?JSON.parse(raw):[];
    const tb=$('recordsBody'); tb.innerHTML='';
    arr.slice().reverse().forEach(r=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${r.t}</td><td>${esc(r.name)}</td><td>${esc(r.from)} → ${esc(r.to)} (${esc(r.flight||'—')})</td><td>${esc(r.date)} ${esc(r.time)}</td><td>${esc(r.promo)}</td>`;
      tb.appendChild(tr);
    });
  }
  function promoBy(dateStr){
    const d=new Date(dateStr+'T12:00'); const day=d.getDay();
    return (day===0||day===6)?'Weekend 25%':'10% off';
  }
  function proceed(){
    const from=$('from').value.trim(), to=$('to').value.trim(), date=$('date').value, time=$('time').value;
    const name=$('name').value.trim(), email=$('email').value.trim(), phone=$('phone').value.trim(), flight=$('flight').value.trim();
    const promo=promoBy(date);
    $('feedback').classList.remove('hidden');
    $('feedback').innerHTML=`<strong>Claim Successful</strong><div style="margin-top:6px">Assigned: <b>${esc(promo)}</b>. Promo sent to <b>${esc(email)}</b>.</div>`;
    const rec={t:now(),name,from,to,date,time,flight,promo};
    const raw=localStorage.getItem(STORAGE_KEY); const arr=raw?JSON.parse(raw):[]; arr.push(rec); localStorage.setItem(STORAGE_KEY,JSON.stringify(arr)); load();
    ping({evt:'proceed',promo});
  }

  const backdrop=$('modalBackdrop');
  function openModal(){backdrop.style.display='flex';backdrop.setAttribute('aria-hidden','false');}
  function closeModal(){backdrop.style.display='none';backdrop.setAttribute('aria-hidden','true');}

  // 打开弹窗
  $('claimBtn').addEventListener('click',()=>{
    const req=['from','to','date','time','name','email','phone'];
    for(const id of req){ if(!$(id).value.trim()){ alert('Please complete all required fields.'); return; } }
    const picked=new Date($('date').value+'T12:00'); if(isNaN(picked)||picked>MAX_DATE){ alert('Departure Date must be ≤ 2026-12-31.'); return; }
    openModal(); ping({evt:'modal_open'});
  });

  $('cancelBtn').addEventListener('click',()=>{ ping({evt:'cancel'}); closeModal(); });

  // —— 关键逻辑：要求滚动到底部后，才解锁勾选框 —— //
  const policy=$('policy');
  const agreeChk=$('agreeChk');
  const agreeLbl=$('agreeLbl');
  const confirmBtn=$('confirmBtn');

  function atBottom(el){
    // 允许 2px 误差
    return el.scrollTop + el.clientHeight >= el.scrollHeight - 2;
  }
  function onScroll(){
    ping({evt:'policy_scroll', st:policy.scrollTop, ch:policy.clientHeight, sh:policy.scrollHeight});
    if(agreeChk.disabled && atBottom(policy)){
      agreeChk.disabled = false;
      agreeLbl.classList.remove('disabled-label');
      $('policyEnd').textContent = 'Checkbox enabled — please tick to continue';
      ping({evt:'checkbox_unlocked'});
    }
  }
  policy.addEventListener('scroll', onScroll, {passive:true});

  // 勾选后启用 Confirm
  agreeChk.addEventListener('change',()=>{
    const en = agreeChk.checked;
    confirmBtn.disabled = !en;
    ping({evt:'checkbox_change', checked: en});
  });

  // Confirm 点击
  confirmBtn.addEventListener('click',()=>{
    ping({evt:'confirm_click'});
    closeModal();
    proceed();
  });

  load(); ping({evt:'page_load'});
})();
</script>
</body>
</html>
